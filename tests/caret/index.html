<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>caretPositionFromPoint Demo</title>
    <style type="text/css">
      textarea, input {
        padding: 10px;
        box-sizing: border-box;
        width: 400px;
        border: 5px solid #686868;
      }
    </style>
    <script type="text/javascript" src="caret.js"></script>
    <script>
      window.onload = function() {
        document.onmousemove = function(e) {
          e = e || window.event;
          var cp = document.caretPositionFromPoint(e.clientX, e.clientY);
          if (!cp) {
            return;
          }
          document.getElementById("px").innerHTML = e.clientX;
          document.getElementById("py").innerHTML = e.clientY;
          document.getElementById("ep").innerHTML = cp.offsetNode;
          document.getElementById("cp").innerHTML = cp.offset;

          var value = 'value' in cp.offsetNode ? cp.offsetNode.value : (cp.offsetNode.innerText || cp.offsetNode.textContent || '');

          var leftSide = value.substr(cp.offset - 5 < 0 ? 0 : cp.offset - 5, cp.offset > 4 ? 5 : cp.offset);
          var rightSide = value.substr(cp.offset, 5);

          document.getElementById("leftSide").innerHTML = leftSide.replace(/\n/g, '\\n').replace(/\s/g, '&nbsp;');
          document.getElementById("rightSide").innerHTML = rightSide.replace(/\n/g, '\\n').replace(/\s/g, '&nbsp;');
        }
      };
    </script>
  </head>
  <body>
    <div id="info-block">
      <div>Point coordinates: <span id="px">0</span>, <span id="py">0</span></div>
      <div>Element from point: <span id="ep">null</span></div>
      <div>Caret position from point: <span id="cp">0</span></div>
      <div>Content of around: <span id="ca" style="display: inline-block; border: 1px solid #000; padding: 10px;">
        <span id="leftSide" style="text-align: right; display: inline-block; width: 70px"></span><span style="line-height: 0;letter-spacing: -0.2485em;margin: 0 5px 0 0;font-size: 1.3em;">&#93;&#91;</span><span id="rightSide" style="text-align: left; display: inline-block; width: 70px"></span>
      </span></div>
    </div>

    <div style="padding: 30px;">
      <input type="text" value="There was nothing so VERY remarkable in that; nor did Alice think it so VERY much out of the way to hear the Rabbit say to itself, `Oh dear! Oh dear! I shall be late!' (when she thought it over afterwards, it occurred to her that she ought to have wondered at this, but at the time it all seemed quite natural); but when the Rabbit actually TOOK A WATCH OUT OF ITS WAISTCOAT-POCKET, and looked at it, and then hurried on, Alice started to her feet, for it flashed across her mind that she had never before seen a rabbit with either a waistcoat-pocket, or a watch to take out of it, and burning with curiosity, she ran across the field after it, and fortunately was just in time to see it pop down a large rabbit-hole under the hedge." />
      <br /><br />
      <textarea rows="10">
There was nothing so VERY remarkable in that; nor did Alice think it so VERY much out of
the way to hear the Rabbit say to itself, `Oh dear! Oh dear! I shall be late!' (when she
thought it over afterwards, it occurred to her that she ought to have wondered at this,
but at the time it all seemed quite natural); but when the Rabbit actually TOOK A WATCH
OUT OF ITS WAISTCOAT-POCKET, and looked at it, and then hurried on, Alice started to her
feet, for it flashed across her mind that she had never before seen a rabbit with either a
waistcoat-pocket, or a watch to take out of it, and burning with curiosity, she ran across
the field after it, and fortunately was just in time to see it pop down a large rabbit-hole
under the hedge.

</textarea>
    </div>
  </body>
</html>